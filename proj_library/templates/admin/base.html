{% load i18n static %}<!DOCTYPE html>
{% get_current_language as LANGUAGE_CODE %}{% get_current_language_bidi as LANGUAGE_BIDI %}
<html lang="{{ LANGUAGE_CODE|default:"en-us" }}" dir="{{ LANGUAGE_BIDI|yesno:'rtl,ltr,auto' }}">
<head>
<title>{% block title %}{% endblock %}</title>
<link rel="stylesheet" href="{% block stylesheet %}{% static "admin/css/base.css" %}{% endblock %}">
{% block dark-mode-vars %}
  <link rel="stylesheet" href="{% static "admin/css/dark_mode.css" %}">
  <script src="{% static "admin/js/theme.js" %}"></script>
{% endblock %}
{% if not is_popup and is_nav_sidebar_enabled %}
  <link rel="stylesheet" href="{% static "admin/css/nav_sidebar.css" %}">
  <script src="{% static 'admin/js/nav_sidebar.js' %}" defer></script>
{% endif %}
{% block extrastyle %}{% endblock %}
{% if LANGUAGE_BIDI %}<link rel="stylesheet" href="{% block stylesheet_rtl %}{% static "admin/css/rtl.css" %}{% endblock %}">{% endif %}
{% block extrahead %}{% endblock %}
{% block responsive %}
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static "admin/css/responsive.css" %}">
    {% if LANGUAGE_BIDI %}<link rel="stylesheet" href="{% static "admin/css/responsive_rtl.css" %}">{% endif %}
{% endblock %}
{% block blockbots %}<meta name="robots" content="NONE,NOARCHIVE">{% endblock %}
</head>

<body class="{% if is_popup %}popup {% endif %}{% block bodyclass %}{% endblock %}"
  data-admin-utc-offset="{% now "Z" %}">
<a href="#content-start" class="skip-to-content-link">{% translate 'Skip to main content' %}</a>

<!-- Container -->
<div id="container">

    {% if not is_popup %}

    <!-- Header -->
    {% block header %}
      <header id="header">
        <div id="branding">
        {% block branding %}{% endblock %}
        </div>
        {% block usertools %}
        {% if has_permission %}
        <div id="user-tools">
            {% block welcome-msg %}
                {% translate 'Welcome,' %}
                <strong>{% firstof user.get_short_name user.get_username %}</strong>.
            {% endblock %}
            {% block userlinks %}
                {% if site_url %}
                    <a href="{{ site_url }}">{% translate 'View site' %}</a> /
                {% endif %}
                {% if user.is_active and user.is_staff %}
                    {% url 'django-admindocs-docroot' as docsroot %}
                    {% if docsroot %}
                        <a href="{{ docsroot }}">{% translate 'Documentation' %}</a> /
                    {% endif %}
                {% endif %}
                {% if user.has_usable_password %}
                <a href="{% url 'admin:password_change' %}">{% translate 'Change password' %}</a> /
                {% endif %}
                <form id="logout-form" method="post" action="{% url 'admin:logout' %}">
                    {% csrf_token %}
                    <button type="submit">{% translate 'Log out' %}</button>
                </form>
                {% include "admin/color_theme_toggle.html" %}
            {% endblock %}
        </div>
        {% endif %}
        {% endblock %}
        {% block nav-global %}{% endblock %}
      </header>
    {% endblock %}
    <!-- END Header -->

    {% block nav-breadcrumbs %}
      <nav aria-label="{% translate 'Breadcrumbs' %}">
        {% block breadcrumbs %}
          <div class="breadcrumbs">
            <a href="{% url 'admin:index' %}">{% translate 'Home' %}</a>
            {% if title %} &rsaquo; {{ title }}{% endif %}
          </div>
        {% endblock %}
      </nav>
    {% endblock %}
    {% endif %}

    <div class="main" id="main">
      {% if not is_popup and is_nav_sidebar_enabled %}
        {% block nav-sidebar %}
          {% include "admin/nav_sidebar.html" %}
        {% endblock %}
      {% endif %}
      <main id="content-start" class="content" tabindex="-1">
        {% block messages %}
          {% if messages %}
            <ul class="messagelist">{% for message in messages %}
              <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message|capfirst }}</li>
            {% endfor %}</ul>
          {% endif %}
        {% endblock messages %}
        <!-- Content -->
        <div id="content" class="{% block coltype %}colM{% endblock %}">
          {% block pretitle %}{% endblock %}
          {% block content_title %}{% if title %}<h3>{{ title }}</h3>{% endif %}{% endblock %}
          {% block content_subtitle %}{% if subtitle %}<h4>{{ subtitle }}</h4>{% endif %}{% endblock %}
          <br>
          {% block content %}
            {% block object-tools %}{% endblock %}
            {{ content }}
          {% endblock %}
          {% block sidebar %}{% endblock %}
          <br class="clear">
        </div>
        <!-- END Content -->
      </main>
    </div>

    <footer id="footer">
    {% block footer %}
        <p>&copy; {% now 'Y' %} Dasir Library. Tutti i diritti riservati.</p>
    {% endblock %}
</footer>


</div>
<!-- END Container -->

<!-- SVGs -->
<svg xmlns="http://www.w3.org/2000/svg" class="base-svgs">
  <symbol viewBox="0 0 24 24" width="1rem" height="1rem" id="icon-auto"><path d="M0 0h24v24H0z" fill="currentColor"/><path d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm0-2V4a8 8 0 1 0 0 16z"/></symbol>
  <symbol viewBox="0 0 24 24" width="1rem" height="1rem" id="icon-moon"><path d="M0 0h24v24H0z" fill="currentColor"/><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938 7.999 7.999 0 0 0 4 12z"/></symbol>
  <symbol viewBox="0 0 24 24" width="1rem" height="1rem" id="icon-sun"><path d="M0 0h24v24H0z" fill="currentColor"/><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/></symbol>
</svg>
<!-- END SVGs -->



<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

<script>
  //Charts

  //Lost Books
  $(function () {
    var $barChart = $("#bar-chart");
    $.ajax({
      url: $barChart.data("url"),
      success: function (data) {

        var bar_ctx = $barChart[0].getContext("2d");

        new Chart(bar_ctx, {
          type: 'bar',
          data: {
            labels: data.labels,
            datasets: [{
              label: 'Lost Books',
              data: data.data,
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true
              }
            },
            responsive: true,
            plugins: {
              legend: {
                position: 'bottom'
              }
          }
          }
        });
      }
    });
  });

  //Books Status
  $(function () {
    var $multibarChart = $("#multibar-chart");
    $.ajax({
      url: $multibarChart.data("url"),
      success: function (data) {

        var multibar_ctx = $multibarChart[0].getContext("2d");

        new Chart(multibar_ctx, {
          type: 'line',
          data: {
            labels: data.labels,
            datasets: [
            {
              label: 'Available',
              data: data.available,
              borderColor: [
                'rgb(255, 99, 132)',
              ],
              fill: false,
              cubicInterpolationMode: 'monotone',
              tension: 0.4
            },
            {
              label: 'On Loan',
              data: data.onLoan,
              borderColor: [
                'rgb(54, 162, 235)',
              ],
              fill: false,
              tension: 0.4
            },
            {
              label: 'Lost',
              data: data.lost,
              borderColor: [
                'rgb(255, 205, 86)'
              ],
              fill: false,
              tension: 0.4
            },
            {
              label: 'Damaged',
              data: data.damaged,
              borderColor: [
                'rgb(0, 255, 86)'
              ],
              fill: false
            },
            {
              label: 'Available Never Loaned',
              data: data.neverLoanedAvailable,
              borderColor: [
                'rgb(255, 145, 0)'
              ],
              fill: false
            },
            {
              label: 'Not Yet Available',
              data: data.neverLoanedNotAvailable,
              borderColor: [
                'rgb(255, 0, 76)'
              ],
              fill: false
            },
            ]
          },
          options: {
            responsive: true,
            interaction: {
              intersect: false,
            },
            scales: {
              x: {
                display: true,
                title: {
                  display: true
                }
              },
              y: {
                display: true,
                title: {
                  display: true,
                },
                suggestedMin: 0,
                suggestedMax: 5
              },
            },
            plugins: {
                legend: {
                  position: 'bottom'
                }
            }
          }
        });
      }
    });
  });

  //Book Genre by Users
  $(function () {
    var $bar2Chart = $("#bar-chart-2");
    $.ajax({
      url: $bar2Chart.data("url"),
      success: function (data) {

        var bar2_ctx = $bar2Chart[0].getContext("2d");

        new Chart(bar2_ctx, {
          type: 'bar',
          data: {
            labels: data.labels,
            datasets: [{
              label: 'Users per Year',
              data: data.data,
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            plugins: {
                legend: {
                  position: 'bottom'
                }
            },
            scales: {
              y: {
                beginAtZero: true
              },
            }
          }
        });
      }
    });
  });

  //Register Users per Year
  $(function () {
    var $pie2Chart = $("#pie-chart-2");
    $.ajax({
      url: $pie2Chart.data("url"),
      success: function (data) {

        var pie2_ctx = $pie2Chart[0].getContext("2d");

        new Chart(pie2_ctx, {
          type: 'pie',
          data: {
            labels: data.labels,
            datasets: [{
              label: 'Books per Status',
              data: data.data,
              backgroundColor: [
                'rgb(255, 99, 132)',
                'rgb(54, 162, 235)',
                'rgb(255, 205, 86)'
              ],
              hoverOffset: 4
            }]
          },
          options: {
            responsive: true,
            plugins: {
                legend: {
                  position: 'bottom'
                }
            }
          }
        });
      }
    });
  });

  //Tables

  //Last Loans
  $.ajax({
    type: 'GET',
    url: '/ajax-last-loans',
    success:
      function(response) {
        const loans = response.loans;
        const tableBody = $('#last-loans');

        loans.forEach((loan, index) => {
          const row = `
            <tr>
              <td>${index + 1}</td>
              <td>${loan.user__username}</td>
              <td>${loan.book__title}</td>
              <td>${loan.status}</td>
              <td>${loan.due_date}</td>
              <td>${loan.insert_date}</td>
              <td>${loan.update_date}</td>
            </tr>
          `;
          tableBody.append(row);
        })
      }
  })

  //Last News
  $.ajax({
    type: 'GET',
    url: '/ajax-last-news',
    success:
      function(response) {
        const news = response.news;
        const tableBody = $('#last-news');

        news.forEach((news, index) => {
          const row = `
            <tr>
              <td>${index + 1}</td>
              <td>${news.img}</td>
              <td>${news.header}</td>
              <td>${news.text}</td>
              <td>${news.insert_date}</td>
              <td>${news.update_date}</td>
            </tr>
          `;
          tableBody.append(row);
        })
      }
  })
</script>

</body>
</html>
